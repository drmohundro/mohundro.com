
title: "Creating a custom control that allows dropping controls on it at design time"
author: David
date: 2006/08/17

This post is just as much for me as it is to share...<br /><br />I was attempting to create a automatically resizing GroupBox control that would let users drop controls on it and it would grow as the controls dropped. I also wanted to offer a FlowLayoutPanel-like ability so that it would slide controls that were lower up if higher controls were hidden. Doesn't sound too bad and we would use it enough that it made sense to encapsulate it in a custom control. I started looking into inheriting from GroupBox and adding a FlowLayoutPanel to it's control collection. Then I hooked into the ControlAdded event for the GroupBox so that I could move the control from the GroupBox to the FlowLayoutPanel. I'm just walking you through the steps in my thinking process here... this apparently isn't how it should be done, because though it worked if controls were added at run-time, it gave me a weird designer error that said "'child' is not a child control of this parent" (<a href="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=155600&amp;SiteID=1">like these guys did</a>).<br /><br />What research I came up with looked like I would have to create my own custom designer to support code like this, that would also include code serialization into InitializeComponent. Yay. A little more research brought me this <a href="http://blogs.msdn.com/subhagpo/archive/2005/03/21/399782.aspx">link</a>, though. It details how to drop controls onto a UserControl at design time. It is a slightly different approach, but it provided what I needed. Basically, the solution also involves using a ControlDesigner, but the code seems much less involved than if I were handling code serialization.<br /><br />Here's a code snippet to give you an idea of what I did:<br /><pre>&lt;Designer(GetType(AutoResizeGroupBoxDesigner))&gt; _<br />Public Class AutoResizeGroupBox<br />    &lt;DesignerSerializationVisibility(DesignerSerializationVisibility.Content)&gt; _<br />    Public ReadOnly Property FlowPanel() As FlowLayoutPanel<br />        Get<br />            ' Where _flowPanel has already been added to the designer<br />            Return _flowPanel<br />        End Get<br />    End Property<br /><br />    ' code snipped...<br /><br />End Class<br /><br />Public Class AutoResizeGroupBoxDesigner<br />    Inherits ControlDesigner<br />    Public Overrides Sub Initialize(ByVal component As System.ComponentModel.IComponent)<br />        MyBase.Initialize(component)<br />        Dim autoGroupBox As AutoResizeGroupBox = DirectCast(component, AutoResizeGroupBox)<br />        EnableDesignMode(autoGroupBox.FlowPanel, "FlowPanel")<br />    End Sub<br />End Class<br /></pre>
